{% extends 'base.html' %}

{% block title %}Set New Password - HisabDe{% endblock %}

{% block extra_css %}
<style>
    .auth-wrapper {
        min-height: calc(100vh - 76px);
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrapper bg-light">
    <div class="card shadow-sm" style="width: 100%; max-width: 420px;">
        <div class="card-body p-4 p-md-5">
            {% if validlink %}
            <!-- Header -->
            <div class="text-center mb-4">
                <div class="mb-3">
                    <i class="fas fa-lock-open fs-1 text-primary"></i>
                </div>
                <h1 class="h3 fw-bold mb-2">Set New Password</h1>
                <p class="text-muted small mb-0">Enter your new password below</p>
            </div>
            
            <form method="post">
                {% csrf_token %}

                {# Show non-field errors (e.g., token problems, validation) #}
                {% if form.non_field_errors %}
                <div class="alert alert-danger" role="alert">
                    {% for error in form.non_field_errors %}
                        <div>{{ error }}</div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- New Password -->
                <div class="mb-3">
                    <label class="form-label small fw-medium">
                        <i class="fas fa-lock me-1"></i>New Password
                    </label>
                    <input type="password" name="new_password1" class="form-control" placeholder="Enter new password" required autofocus>
                    {% if form.errors.new_password1 %}
                        <div class="text-danger small mt-1">
                            {% for err in form.errors.new_password1 %}{{ err }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Confirm Password -->
                <div class="mb-3">
                    <label class="form-label small fw-medium">
                        <i class="fas fa-lock me-1"></i>Confirm Password
                    </label>
                    <input type="password" name="new_password2" class="form-control" placeholder="Confirm new password" required>
                    {% if form.errors.new_password2 %}
                        <div class="text-danger small mt-1">
                            {% for err in form.errors.new_password2 %}{{ err }}{% if not forloop.last %}<br>{% endif %}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Submit -->
                <button type="submit" class="btn btn-primary w-100 mb-3">
                    <i class="fas fa-check me-2"></i>Set Password
                </button>

                <!-- Link -->
                <div class="text-center">
                    <a href="{% url 'login' %}" class="text-decoration-none small">
                        <i class="fas fa-arrow-left me-1"></i>Back to Login
                    </a>
                </div>
            </form>
            
            {% else %}
            <!-- Invalid Link -->
            <div class="text-center mb-4">
                <div class="mb-3">
                    <i class="fas fa-exclamation-circle fs-1 text-danger"></i>
                </div>
                <h1 class="h3 fw-bold mb-2">Invalid Link</h1>
                <p class="text-muted small mb-0">This reset link is invalid or has expired</p>
            </div>
            
            <div class="alert alert-danger border-0 mb-4">
                <div class="d-flex">
                    <i class="fas fa-times-circle me-2 mt-1"></i>
                    <div>
                        <p class="fw-medium mb-2">Reset Link Expired</p>
                        <p class="small mb-0">This password reset link is invalid or has expired. Please request a new one.</p>
                    </div>
                </div>
            </div>
            
            <div class="d-grid gap-2">
                <a href="{% url 'password_reset' %}" class="btn btn-primary">
                    <i class="fas fa-redo me-2"></i>Request New Link
                </a>
                <a href="{% url 'login' %}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Login
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}